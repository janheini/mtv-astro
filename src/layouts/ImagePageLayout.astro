---
import BasePageLayout from "@layouts/BasePageLayout.astro";
import type { ImageMetadata } from "astro";
import { Image } from "astro:assets";

interface Props {
  frontmatter: {
    title: string;
    author?: string | undefined;
    date?: Date | undefined;
    hero?: string | undefined;
    gallery?: Array<{ image: string }> | undefined;
  };
}

const { title, author, date, hero, gallery } = Astro.props.frontmatter;

const all_images = import.meta.glob<{ default: ImageMetadata }>("@assets/**");

// check if the images from props are in all_images (exist)
if (gallery) {
  for (const image of gallery) {
    if (!all_images[image.image])
      throw new Error(`"${image.image}" does not exist in glob: "@assets/**"`);
  }
}

if (hero) {
  if (!all_images[hero]) {
    throw new Error(`"${hero}" does not exist in glob: "@assets/**"`);
  }
}
---

<BasePageLayout>
  <div>
    <h1 class="inline">{title}</h1>
    <div class="flex w-full justify-end">
      <span class="prose-sm">
        {date && <>{date.toLocaleDateString()}</>}
        {author && <> von {author}</>}
      </span>
    </div>
  </div>
  <article>
    <slot />
  </article>
  <Fragment slot="below">
    <div
      class="grid max-w-screen-lg grid-cols-1 justify-start gap-8 pt-8 lg:grid-cols-2"
    >
      {
        gallery &&
          gallery.map((image) => (
            <Image src={all_images[image.image]()} alt="" />
          ))
      }
    </div>
  </Fragment>
</BasePageLayout>
